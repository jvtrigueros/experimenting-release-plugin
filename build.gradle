buildscript {
    repositories {
        mavenCentral()
    }
}

plugins {
    id 'pl.allegro.tech.build.axion-release' version '1.3.4'
}

repositories {
    mavenCentral()
}

apply plugin: 'scala'
apply plugin: 'idea'

dependencies {
    compile "org.scala-lang:scala-library:2.11.7"
}

scmVersion {
    versionIncrementer 'incrementMinor'
    ignoreUncommittedChanges = false
    tag {
        prefix = ''
    }

    String pluginPath = "src/main/resources/META-INF/plugin.xml"
    hooks {
        pre 'fileUpdate', [ file: pluginPath
                          , pattern: {v, c -> /(<version>)${c.currentVersion}-SNAPSHOT(<\/version>)/}
                          , replacement: {v, p -> "\$1$v\$2"}
                          ]
        pre 'commit'

        post 'fileUpdate', [ file: pluginPath
                           , pattern: {v, c -> println("readversion ${c.readVersion()}"); /(<version>)${c.readVersion()}(<\/version>)/}
                           , replacement: {v, c -> println(c.readVersion()); "\$1${c.readVersion()}-SNAPSHOT\$2"}
                           ]
        post 'commit'
    }
}

group 'test'
project.version = scmVersion.version